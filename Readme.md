# CJLU 门锁改装计划
> CJLU_FPLockProject

欢迎阅读此说明。本项目是中国计量大学云莓智能的门锁改装计划项目主项目说明文档。
该项目由若干部分构成，你可以选择你需要的任意部分进行使用。

[TOC]
## 文件结构

```plain
|-assets    markdown相关的资源
|-model     3D模型
|-server    云服务器代码(WIP)
|-src       Ardunio相关功能模块
|-web       网页相关的所有
  |-pages   单片机上存储的一些页面源文件
  |-visitor 访客管理系统(WIP)
|-pcb.zip   嘉立创EDA导出项目
|-test.ino  单片机主项目文件
```


## 物理结构改装与加装

### 改装

物理结构设计上使用的方案最初来自一位网名dome的群友，在此感谢。

**注意：本文提供的方案将需要拆装寝室门锁。对此造成的任何可能的问题，作者不会为你承担任何责任。**

**由于门锁的奇特结构，拆装时请务必两人操作，并妥善保管内外侧门锁**

可行操作流程：

+ 拆下门锁（拆下门锁电池盒内和底部的两颗螺丝）
+ 拆下门锁内连着锁舌的一块结构（锁舌伸出平面的三个螺丝）
+ 位于该结构左上角有一开窗中，穿过一根线，使其能够直接拉动锁舌
+ 从门把手穿孔中穿过xh2.45-6p <=> sh1.00-60线。外侧需要略微留长
+ 将门锁装回，在线引出部分使用小棍或类似物品垫高（有必要可以拆除门内的塑料底板）
+ 测试门是否可以正常关闭，引出的线是否可以正常拉动

至此，改装部分结束，后续结构均不需要更改已有结构。

### 加装

加装部分为两个3D打印件。可以在项目内找到STL和SLDPRT（Solidworks的源文件）。

门外部分用于嵌入一个指纹模块，指纹模块采用的是海凌科HLK-FPM383C（HLK-ZW101为淘宝店家标注的名字，暂时不知道哪个是商品型号）

门内部分用于支撑舵机和单片机及其拓展板。舵机可选MG90,PM10S等。具体尺寸见设计图。单片机拓展版上预留的排母适用于ESP32-C3 supermini开发板。门内的结构可以使用C字形夹紧件固定在门锁上。

拓展板PCB上需要焊接的元件为：2.45-8P排母两个（单片机），XH2.45插座一个（指纹），2.45-3P排针一个（舵机）。推荐同时购买XH2.45延长线。

> PCB 理论上来说还能在这里 [嘉立创社区](https://oshwhub.com/zxypp/esp32_extend_board) 看到（审核没过就不清楚了）

## 门上单片机控制部分

单片机可以在通电时持续按住指纹模块来进入配置模式。配置模式下可以添加指纹，配置无线网络等。配置模式下传感器上蓝色灯光闪烁，此时可以连接到`FingerprintLock`无线网络，并访问http://192.168.4.1/即可进入配置页面。

## 云服务器及其页面（WIP）



## 安装须知

安装完毕所有结构后，请**拆下舵机臂**再通电。通电后待舵机完成转动再安装舵机臂。

进入配置模式，点击调节舵机按钮，**从0开始小幅度增加**调节舵机值（一般最终会调节到一千附近，取决于舵机型号）

在配置模式中，按下添加指纹按钮。观察按钮上的文字。将手指放在传感器上，传感器闪绿色表示成功读取到一次，按钮上的数字会对应增加。当录入完成，手机上弹窗显示“done”

完成后，重新连接电源即可正常使用

## 鸣谢

感谢 Karlcx，去皮的大土豆，dome（QQ名）的支持。感谢室友的理解

欢迎加入云梅不智能群交流门锁折腾 704883666

欢迎fork，issue，pr（但是不保证有时间能处理）